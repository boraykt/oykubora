<!DOCTYPE html><!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>AnÄ±larÄ±mÄ±z</title>
<link rel="stylesheet" href="style.css">
<link rel="icon" type="image/png" href="heart.png">
</head>

<body class="dark">

<div class="side-menu">
  <h2>MENÃœ</h2>
  <nav>
    <a href="index.html">Ana Sayfa</a>
    <a href="galeri.html">FotoÄŸraflar</a>
    <a href="mesaj.html">Mesaj BÄ±rak</a>
    <a href="anilar.html">AnÄ±larÄ±mÄ±z</a>
    <a href="mesajlar.html">Mesajlar</a>
    <a href="sonsuzluk.html">Sonsuzluk</a>
  </nav>
</div>

<div class="page-content">
  <h1>ğŸ“¸ AnÄ± Ekle</h1>

  <form id="aniForm">
    <input type="file" id="foto" accept="image/*" required>
    <textarea id="aniMesaj" placeholder="Bu anÄ±yÄ± anlat..." required></textarea>
    <button type="submit">AnÄ± Kaydet</button>
  </form>

  <h2 style="margin-top:50px;">ğŸ’ AnÄ±larÄ±mÄ±z</h2>
  <div id="anilarListesi"></div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, where, orderBy } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyC15_7m7NfYUBkrNWp9uDqw7n3IePBoE2s",
  authDomain: "oykubora-bdf60.firebaseapp.com",
  projectId: "oykubora-bdf60",
  storageBucket: "oykubora-bdf60.appspot.com"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const storage = getStorage(app);

const siteID = "bora-oyku";

const form = document.getElementById("aniForm");
const anilarListesi = document.getElementById("anilarListesi");

form.addEventListener("submit", async (e) => {
  e.preventDefault();

  const file = document.getElementById("foto").files[0];
  const mesaj = document.getElementById("aniMesaj").value.trim();

  if(!file || !mesaj){
    alert("FotoÄŸraf ve mesaj zorunlu â¤ï¸");
    return;
  }

  const storageRef = ref(storage, "anilar/" + Date.now() + "_" + file.name);

  await uploadBytes(storageRef, file);
  const downloadURL = await getDownloadURL(storageRef);

  await addDoc(collection(db, "anilar"), {
    siteID: siteID,
    mesaj: mesaj,
    fotoURL: downloadURL,
    tarih: new Date()
  });

  alert("AnÄ± eklendi ğŸ’–");
  form.reset();
  anilariGetir();
});

async function anilariGetir() {

  const q = query(
    collection(db, "anilar"),
    where("siteID", "==", siteID),
    orderBy("tarih", "desc")
  );

  const snapshot = await getDocs(q);

  anilarListesi.innerHTML = "";

  snapshot.forEach((doc) => {
    const data = doc.data();

    anilarListesi.innerHTML += `
      <div class="memory-card">
        <img src="${data.fotoURL}" />
        <p>${data.mesaj}</p>
      </div>
    `;
  });
}

anilariGetir();

</script>

</body>
</html>
